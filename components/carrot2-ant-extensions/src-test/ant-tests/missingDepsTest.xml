
<project name="missing-deps-test" default="test">
    
	<target name="standalone">
        <taskdef name="printDependencies" 
        	classname="com.dawidweiss.carrot.ant.PrintDependencies">
			<classpath location="../../tmp/build/bootstrap" />
		</taskdef>
        <delete dir="tmp" />
		<mkdir dir="tmp"/>

		<antcall target="dotest" />
	</target>

    <target name="prepare">
        <taskdef name="printDependencies" 
        	classname="com.dawidweiss.carrot.ant.PrintDependencies" />
        <delete dir="tmp" />
		<mkdir dir="tmp"/>
    </target>

	<target name="test" depends="prepare,dotest">
	</target>
	
	<target name="dotest">
		<path id="dep1">
		<fileset dir="missingDepsTest/missingDepsTest_projb">
			<include name="*.dep.xml" />
		</fileset>
		</path>
		<path id="dep2">
		<fileset dir="missingDepsTest/missingDepsTest_projc">
			<include name="*.dep.xml" />
		</fileset>
		</path>

		<printDependencies componentDescriptor="missingDepsTest/missingDepsTest_proja/a.dep.xml"
			file="tmp/dependencies.txt" property="tmp:dependencies:string">
			<dependencies refid="dep1" />
			<dependencies refid="dep2" />
		</printDependencies>

		<available property="tmp:dep:ok" value="ok" file="tmp/dependencies.txt" type="file" />
		<fail unless="tmp:dep:ok">
			Printing dependencies failed.
		</fail>
		
		<fail unless="tmp:dependencies:string">
			Property not set.
		</fail>
		
		<condition property="tmp:contains" value="true">
			<contains string="${tmp:dependencies:string}" substring="projc" />
		</condition>

		<fail unless="tmp:contains">Dependency c not present in the print info.</fail>		

		<echo>
		${tmp:dependencies:string}
		</echo>	
	</target>
    
</project>